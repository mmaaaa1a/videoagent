[2025-10-07 19:31:01] 🚀 Starting VideoRAG Web API on port 64451
[2025-10-07 19:31:01] 📝 Main process PID: 935530
[2025-10-07 19:31:04] 🔄 Returning default configuration from environment variables
[2025-10-07 19:31:07] ✅ 同步配置 image_bind_model_path -> IMAGEBIND_MODEL_PATH = /data/项目/videoagent/models
[2025-10-07 19:31:07] ✅ 同步配置 asr_model -> ASR_MODEL = paraformer-v2
[2025-10-07 19:31:07] ✅ 配置同步到环境变量完成
[2025-10-07 19:31:07] 🔄 Global config set: {'openai_api_key': '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', 'openai_base_url': 'https://openrouter.ai/api/v1/', 'ali_dashscope_api_key': 'sk-3236ebaa10bc477987e3264e8a8b7d0f', 'ali_dashscope_base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'analysisModel': 'x-ai/grok-code-fast-1', 'processingModel': 'x-ai/grok-code-fast-1', 'caption_model': 'qwen-vl-plus', 'asr_model': 'paraformer-v2', 'image_bind_model_path': '/data/项目/videoagent/models', 'base_storage_path': '/data/项目/videoagent/storage'}
[2025-10-07 19:31:07] ✅ ImageBind manager configured with model path: /data/项目/videoagent/models
[2025-10-07 19:31:12] 🔍 Scanning video files in: /data/项目/videoagent/storage
[2025-10-07 19:31:14] 📹 Starting video processing from web upload: 1 files
[2025-10-07 19:31:16] 🔍 Session status: {'status': 'processing', 'message': 'Initializing AI Assistant...', 'current_step': 'Initializing', 'total_videos': 1, 'processed_videos': 0}
[2025-10-07 19:31:19] 🔍 Session status: {'status': 'processing', 'message': 'Initializing AI Assistant...', 'current_step': 'Initializing', 'total_videos': 1, 'processed_videos': 0}
[2025-10-07 19:31:19] 🔧 Index worker process 937099 set name to: videorag-index-8wxp8zjg29fvdghctt0csk
[2025-10-07 19:31:19] 🔍 Session status: {'status': 'processing', 'message': 'Initializing AI Assistant...', 'current_step': 'Initializing'}
[2025-10-07 19:31:19] 🎤 ASR配置: 模式=local, 模型=paraformer-v2
[2025-10-07 19:31:19] 🔗 嵌入配置: URL=https://dashscope.aliyuncs.com/compatible-mode/v1, 模型=text-embedding-v4, 维度=1024
[2025-10-07 19:31:21] 🔍 Session status: {'status': 'processing', 'message': 'Initializing AI Assistant...', 'current_step': 'Initializing', 'total_videos': 1, 'processed_videos': 0}
[2025-10-07 19:31:23] 🔍 Session status: {'status': 'processing', 'message': 'Initializing AI Assistant...', 'current_step': 'Initializing', 'total_videos': 1, 'processed_videos': 0}
[2025-10-07 19:31:23] 🔍 Session status: {'status': 'processing', 'message': 'Processing video: 1759707563218-0-0-30', 'current_step': 'Starting Video', 'timestamp': 1759836683.389957}
[2025-10-07 19:31:23] 📊 Progress: Starting Video - Processing video: 1759707563218-0-0-30
[2025-10-07 19:31:23] 🔍 Session status: {'status': 'processing', 'message': 'Splitting video: 1759707563218-0-0-30 into segments', 'current_step': 'Splitting Video', 'timestamp': 1759836683.3908432}
[2025-10-07 19:31:23] 📊 Progress: Splitting Video - Splitting video: 1759707563218-0-0-30 into segments
[2025-10-07 19:31:24] 🔍 Session status: {'status': 'processing', 'message': 'Video 1759707563218-0-0-30 split into 1 segments', 'current_step': 'Video Split', 'timestamp': 1759836684.6241472}
[2025-10-07 19:31:24] 📊 Progress: Video Split - Video 1759707563218-0-0-30 split into 1 segments
[2025-10-07 19:31:24] 🔍 Session status: {'status': 'processing', 'message': 'Transcribing audio for video: 1759707563218-0-0-30', 'current_step': 'Transcribing Audio', 'timestamp': 1759836684.6246815}
[2025-10-07 19:31:24] 📊 Progress: Transcribing Audio - Transcribing audio for video: 1759707563218-0-0-30
[2025-10-07 19:31:25] 🔍 Session status: {'status': 'processing', 'message': 'Transcribing audio for video: 1759707563218-0-0-30', 'current_step': 'Transcribing Audio', 'total_videos': 1, 'processed_videos': 0, 'timestamp': 1759836684.6246815}
[2025-10-07 19:31:27] 🔍 Session status: {'status': 'processing', 'message': 'Transcribing audio for video: 1759707563218-0-0-30', 'current_step': 'Transcribing Audio', 'total_videos': 1, 'processed_videos': 0, 'timestamp': 1759836684.6246815}
[2025-10-07 19:31:29] 🔍 Session status: {'status': 'processing', 'message': 'Transcribing audio for video: 1759707563218-0-0-30', 'current_step': 'Transcribing Audio', 'total_videos': 1, 'processed_videos': 0, 'timestamp': 1759836684.6246815}
[2025-10-07 19:32:06] 🔍 Session status: {'status': 'processing', 'message': 'ASR处理中: 1/1 (速度: 0.02/秒)', 'current_step': 'Transcribing Audio', 'progress_current': 1, 'progress_total': 1, 'progress_percentage': 100.0, 'processing_speed': '0.02 文件/秒', 'eta': '', 'resource_usage': {'cpu': '0%', 'memory': '30%'}, 'timestamp': 1759836726.238021}
[2025-10-07 19:32:06] 📊 Progress: Transcribing Audio - ASR处理中: 1/1 (速度: 0.02/秒)
[2025-10-07 19:32:06] 🔍 Session status: {'status': 'processing', 'message': 'Audio transcription completed for video: 1759707563218-0-0-30', 'current_step': 'Audio Transcribed', 'timestamp': 1759836726.241148}
[2025-10-07 19:32:06] 📊 Progress: Audio Transcribed - Audio transcription completed for video: 1759707563218-0-0-30
[2025-10-07 19:32:06] 🔍 Session status: {'status': 'processing', 'message': 'Processing video segments for: 1759707563218-0-0-30', 'current_step': 'Processing Segments', 'timestamp': 1759836726.241588}
[2025-10-07 19:32:06] 📊 Progress: Processing Segments - Processing video segments for: 1759707563218-0-0-30
[2025-10-07 19:32:19] 🔍 Session status: {'status': 'processing', 'message': '开始生成字幕: 1759707563218-0-0-30 (1 个片段)', 'current_step': 'Generating Captions', 'timestamp': 1759836739.5410075}
[2025-10-07 19:32:19] 📊 Progress: Generating Captions - 开始生成字幕: 1759707563218-0-0-30 (1 个片段)
[2025-10-07 19:32:20] 🔍 Scanning video files in: /data/项目/videoagent/storage
[2025-10-07 19:34:27] 🔍 Session status: {'status': 'processing', 'message': '字幕生成完成: 1/1 成功, 耗时 132.22s (速度: 0.01 片段/秒)', 'current_step': 'Captions Generated', 'timestamp': 1759836867.4301834}
[2025-10-07 19:34:27] 📊 Progress: Captions Generated - 字幕生成完成: 1/1 成功, 耗时 132.22s (速度: 0.01 片段/秒)
[2025-10-07 19:34:29] 🔍 Session status: {'status': 'processing', 'message': 'Video segments processed and captions generated for: 1759707563218-0-0-30', 'current_step': 'Segments Processed', 'timestamp': 1759836869.1373477}
[2025-10-07 19:34:29] 📊 Progress: Segments Processed - Video segments processed and captions generated for: 1759707563218-0-0-30
[2025-10-07 19:34:30] 🔍 Session status: {'status': 'processing', 'message': 'Encoding video features for: 1759707563218-0-0-30', 'current_step': 'Encoding Features', 'timestamp': 1759836870.0933805}
[2025-10-07 19:34:30] 📊 Progress: Encoding Features - Encoding video features for: 1759707563218-0-0-30
[2025-10-07 19:35:12] 🔍 Session status: {'status': 'processing', 'message': 'Video features encoded for: 1759707563218-0-0-30', 'current_step': 'Features Encoded', 'timestamp': 1759836912.2699788}
[2025-10-07 19:35:12] 📊 Progress: Features Encoded - Video features encoded for: 1759707563218-0-0-30
[2025-10-07 19:35:12] 🔍 Session status: {'status': 'processing', 'message': 'Video processing completed: 1759707563218-0-0-30', 'current_step': 'One Video Completed', 'timestamp': 1759836912.2757583}
[2025-10-07 19:35:12] 📊 Progress: One Video Completed - Video processing completed: 1759707563218-0-0-30
[2025-10-07 19:35:12] ✅ Video completed: 1759707563218-0-0-30.mp4
[2025-10-07 19:35:13] 🔍 Session status: {'status': 'error', 'message': "Video indexing failed: 'global_config'", 'current_step': 'Error'}
[2025-10-07 19:35:13] ❌ Process-based video indexing failed: 'global_config'
[2025-10-07 19:35:54] 🔔 Received signal 2, initiating shutdown...
[2025-10-07 19:35:54] 🔔 Received signal 15, initiating shutdown...
[2025-10-07 19:35:54] 🔔 VideoRAG API server is shutting down...
[2025-10-07 19:35:54] 🧹 Starting process cleanup...
[2025-10-07 19:35:56] 🧹 Process manager cleanup completed
[2025-10-07 19:35:56] ⚠️ ImageBind not loaded, nothing to release
[2025-10-07 19:35:56] 🧹 ImageBind manager cleaned up
[2025-10-07 19:35:56] ✅ Cleanup completed
[2025-10-07 19:40:58] 🔍 开始验证global_config配置...
[2025-10-07 19:40:58] ⚠️ 发现缺失配置字段，已设置默认值: ['caption_model', 'tiktoken_model_name', 'entity_extract_max_gleaning', 'entity_summary_to_max_tokens', 'max_graph_cluster_size', 'graph_cluster_seed', 'retrieval_topk_chunks', 'fine_num_frames_per_segment', 'video_embedding_batch_num', 'video_embedding_dim']
[2025-10-07 19:40:58] ⚠️ LLM配置缺失，创建空的LLM配置
[2025-10-07 19:40:58] ⚠️ 发现缺失的LLM配置字段: ['best_model_func', 'cheap_model_func', 'embedding_func', 'best_model_name', 'cheap_model_name', 'embedding_model_name', 'embedding_dim', 'best_model_max_token_size', 'cheap_model_max_token_size', 'embedding_batch_num']
[2025-10-07 19:40:58] ⚠️ addon_params配置缺失，创建空配置
[2025-10-07 19:40:58] ✅ global_config配置验证完成
[2025-10-07 19:43:39] 🔍 开始验证global_config配置...
[2025-10-07 19:43:39] ⚠️ 发现缺失配置字段，已设置默认值: ['processingModel', 'caption_model', 'tiktoken_model_name', 'entity_extract_max_gleaning', 'entity_summary_to_max_tokens', 'max_graph_cluster_size', 'graph_cluster_seed', 'retrieval_topk_chunks', 'fine_num_frames_per_segment', 'video_embedding_batch_num', 'video_embedding_dim']
[2025-10-07 19:43:39] ⚠️ LLM配置缺失，创建空的LLM配置
[2025-10-07 19:43:39] ⚠️ 发现缺失的LLM配置字段: ['best_model_func', 'cheap_model_func', 'embedding_func', 'best_model_name', 'cheap_model_name', 'embedding_model_name', 'embedding_dim', 'best_model_max_token_size', 'cheap_model_max_token_size', 'embedding_batch_num']
[2025-10-07 19:43:39] ⚠️ addon_params配置缺失，创建空配置
[2025-10-07 19:43:39] ✅ global_config配置验证完成
