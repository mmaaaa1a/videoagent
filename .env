# ============================================
# VideoRAG 环境配置文件
# ============================================
# 复制此文件为 .env 并填入实际值

# ============================================
# 服务器配置
# ============================================
SERVER_HOST=0.0.0.0
SERVER_PORT=64451
INTERNAL_PORT=64451

#API Keys (required for VideoRAG functionality)
OPENAI_API_KEY=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
OPENAI_BASE_URL=https://openrouter.ai/api/v1/
ALI_DASHSCOPE_API_KEY=sk-3236ebaa10bc477987e3264e8a8b7d0f
ALI_DASHSCOPE_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1

# Model Configurations
ANALYSIS_MODEL=x-ai/grok-code-fast-1
PROCESSING_MODEL=x-ai/grok-code-fast-1
CAPTION_MODEL=qwen-vl-plus
# ASR配置 - 可切换本地或云端处理
ASR_MODE=local
ASR_MODEL=large-v3

# EPYC 64核心优化配置
USE_EPYC_OPTIMIZATION=true
EPYC_NUM_MODELS=32
EPYC_BATCH_SIZE=32
EPYC_WORKERS=32
EPYC_COMPUTE_TYPE=float32

# EPYC系统级环境变量优化 (64核心配置)
OMP_NUM_THREADS=32
MKL_NUM_THREADS=32
OPENBLAS_NUM_THREADS=32
NUMEXPR_NUM_THREADS=32
MALLOC_ARENA_MAX=64         # 增加内存分配区域

# GGUF模型CPU优化配置
GGUF_N_THREADS=32            # GGUF模型使用的线程数
GGUF_BATCH_SIZE=64          # GGUF批处理大小
GGUF_CONTEXT_SIZE=32768      # 增加上下文大小，利用256GB内存

# 64核心EPYC专用优化配置
EPYC_USE_AFFINITY=true      # CPU亲和性优化
EPYC_MEMORY_HOG=true        # 内存激进策略（256GB内存）
EPYC_CACHE_SIZE=64          # 增加缓存大小
EPYC_PREFETCH_DISTANCE=32   # 预取距离优化

# 高级内存优化
PYTHONMALLOC=malloc         # 使用malloc内存分配器
MALLOC_TRIM_THRESHOLD_=100000 # 内存整理阈值

# ImageBind Model Path (download the model or use container default)
IMAGEBIND_MODEL_PATH=/app/models

# Storage Configuration
BASE_STORAGE_PATH=/app/storage

# ============================================
# 字幕生成模型配置
# ============================================
# USE_GGUF_CAPTION: true=使用GGUF模型(MiniCPM-o-2_6), false=使用原有MiniCPM-V模型
USE_GGUF_CAPTION=true
# GGUF模型路径配置
CAPTION_MODEL_PATH=/data/项目/videoagent/models/MiniCPM-o-2_6-gguf/.cache/huggingface/download/Model-7.6B-Q4_K_M.gguf

# ============================================
# 开发环境配置 (仅开发时使用)
# ============================================
# 前端开发端口
WEB_DEV_PORT=3000

# 前端API配置（用于本地开发）
VITE_API_PORT=64451

# 后端开发端口

# ============================================
# 部署配置
# ============================================
# 容器名称前缀
CONTAINER_PREFIX=videorag

# 镜像标签
IMAGE_TAG=latest

# ============================================
# 1panel部署配置
# ============================================
# 服务器路径
SERVER_PATH=/opt/1panel/apps/videorag

# 域名配置
SERVER_DOMAIN=localhost

# ============================================
# GPU配置 (可选)
# ============================================
# CUDA设备 (留空使用CPU)
CUDA_VISIBLE_DEVICES=

# ============================================
# 高级配置
# ============================================
# 调试模式
FLASK_DEBUG=false

# 日志级别
LOG_LEVEL=INFO

# 最大文件上传大小 (MB)
MAX_UPLOAD_SIZE=500

# 并发处理数
MAX_CONCURRENT_REQUESTS=10

# 缓存时间 (秒)
CACHE_TTL=3600

# ============================================
# 安全配置
# ============================================
# JWT密钥
JWT_SECRET=g3gegrdgfd32wdwfes

# 会话超时时间 (秒)
SESSION_TIMEOUT=86400

# CORS允许的源
CORS_ORIGINS=*

# ============================================
# 嵌入模型配置 (新增)
# ============================================
EMBEDDING_API_KEY=sk-3236ebaa10bc477987e3264e8a8b7d0f  # 使用Ali DashScope API Key
EMBEDDING_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
EMBEDDING_MODEL_NAME=text-embedding-v4
EMBEDDING_MODEL_DIM=1024

# ============================================
# 监控配置
# ============================================
# 健康检查间隔 (秒)
HEALTH_CHECK_INTERVAL=30

# 性能监控
ENABLE_METRICS=true

# 日志轮转
LOG_ROTATION=true
MAX_LOG_SIZE=100MB
MAX_LOG_FILES=10